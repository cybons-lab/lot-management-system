= 完了機能サマリー
:toc: left
:toc-title: 目次

**最終更新:** 2025-12-04

== 概要

このドキュメントは、実装が完了した主要機能の要約です。
詳細な設計・実装は各モデル・サービスのコードとCLAUDE.mdを参照してください。

== 主要機能

=== 1. ロット引当システム

**実装完了:** 2025-11

==== 機能概要

* 受注明細に対する在庫ロットの自動引当
* FEFO（先入れ先出し期限管理）ロジック
* Soft Allocation（推奨引当）をサポート
* Hard Allocation（確定引当）はスキーマ準備済み（v3.0予定）

==== 主要ファイル

* `backend/app/services/allocations/` - 引当サービス
* `frontend/src/features/allocations/` - 引当UI
* `backend/app/models/inventory_models.py:Allocation`

==== UI機能

* Phase 1-5の段階的改善完了
* ドラッグ&ドロップによる引当操作
* リアルタイム在庫更新
* 自動引当 + 手動調整

=== 2. 予測管理システム

**実装完了:** 2025-11

==== 機能概要

* 顧客別・製品別・納品先別の需要予測
* 日次予測データの管理
* 予測と実績の比較
* 予測インポート機能

==== 主要ファイル

* `backend/app/services/forecasts/` - 予測サービス
* `frontend/src/features/forecasts/` - 予測UI
* `backend/app/models/forecast_models.py`

==== UI機能

* 予測詳細カード（集約・日次表示）
* 在庫サマリー統合表示
* 入荷予定表示
* モックSAP注文登録UI

=== 3. SAP連携（モック）

**実装完了:** 2025-11

==== 機能概要

* SAP在庫トータルチェック（日次バッチ）
* SAP受注登録（モック実装）
* 在庫差異アラート（business_rulesテーブル）

==== 主要ファイル

* `backend/app/external/sap_mock_client.py` - モッククライアント
* `backend/app/services/batch/inventory_sync_service.py` - 在庫同期
* `frontend/src/features/sap/` - SAP連携UI

==== 本番対応

モック実装のため、本番SAP APIへの切り替えが必要（future work）

=== 4. 単位換算システム

**実装完了:** 2025-11

==== 機能概要

* 製品ごとの単位換算定義
* 内部単位（EA）への自動変換
* 受注・入荷での単位換算サポート

==== 主要ファイル

* `backend/app/models/masters_models.py:ProductUomConversion`
* `backend/app/services/uom_service.py`
* `frontend/src/features/uom-conversions/`

==== 換算ロジック

* source_value × (internal_unit_value / source_value) = internal_unit
* 例: 1ダース = 12EA

=== 5. 入荷管理

**実装完了:** 2025-11

==== 機能概要

* 入荷予定（Inbound Plans）管理
* 入庫確定フロー
* ロット自動生成
* 在庫への自動反映

==== 主要ファイル

* `backend/app/services/inbound/` - 入荷サービス
* `frontend/src/features/inbound-plans/` - 入荷UI
* `backend/app/models/inbound_models.py`

==== フロー

. SAP連携で入荷予定取得
. 入荷予定一覧で確認
. 入庫確定 → ロット作成 → 在庫追加

== アーキテクチャ改善

=== プロジェクト構造リファクタリング

**実装完了:** 2025-11

==== Phase 1-3完了

* `view_models/` 統合
* `db/` 削除
* assignments、forecast、tools 統合
* allocations feature化
* InboundService、ForecastService 分離

==== 成果

* レイヤー化の徹底（API → Service → Repository → Model）
* Feature-based構造の確立
* コード重複の削減

=== パフォーマンス最適化

**実装完了:** 2025-11

==== 主要改善

* `v_order_line_details` ビュー導入
* N+1クエリ削減（eager loading）
* ページネーション実装（50件/page）
* React Queryキャッシュ最適化

==== 成果

* 受注一覧の読み込み速度 70%改善
* API応答時間 < 200ms（95%ile）

== UI/UX改善

=== 受注管理の明細単位化

**実装完了:** 2025-11

* 受注を明細単位で表示・管理
* ステータス複合表示（全般状況 + 詳細）
* オーダー集約表示（Group by Order）

=== レイアウト改善

**実装完了:** 2025-11

* 長い文字列のtruncate処理
* max-width設定
* ツールチップ表示

== テスト

=== バックエンドテスト

**実装状況:** 25+ tests

* Unit tests: サービス層
* Integration tests: API エンドポイント
* Fixture管理: pytest

=== フロントエンドテスト

**実装状況:** 26+ tests（Vitest）

* Jest → Vitest 移行済み
* MSWハンドラー定義
* Unit/Feature テスト
* TypeCheck: 0エラー達成

=== OpenAPI型統一

**実装完了:** 2025-12-04

==== 機能概要

* `typegen` スクリプトで `src/types/api.d.ts` を自動生成
* バックエンドOpenAPIスキーマから型を自動抽出
* 手動型定義ファイル（`openapi.d.ts`）を廃止し一本化

==== 主要ファイル

* `frontend/package.json` - typegen, typegen:curl スクリプト
* `frontend/src/types/api.d.ts` - 生成された型定義
* `backend/openapi.json` - OpenAPI仕様

==== 成果

* TypeCheckエラー 0件達成
* 型定義の二重管理を解消
* バックエンドスキーマ変更の自動反映

== CI/CD

**実装完了:** 2025-12

=== GitHub Actions ワークフロー

* **フロントエンド:** lint、typecheck、test実行
* **バックエンド:** ruff check（テストは一時スキップ）
* PostgreSQL 15サービスコンテナ

=== 主要ファイル

* `.github/workflows/ci.yml`
* `backend/tests/conftest.py`
* `backend/tests/conftest_hypothesis.py`

=== 今後の改善予定

* バックエンドテストの安定化（DBタイムアウト対策）
* 並列テスト実行の検討

== 残課題

詳細は `docs/tasks/ACTIVE_TASKS.md` を参照

== 参照ドキュメント

* **技術詳細:** `CLAUDE.md` - 設計基準、開発ガイドライン
* **API仕様:** `api_reference.adoc`
* **DB設計:** `schema.adoc`
* **フロー図:** `system_diagrams.html`
* **タスク管理:** `docs/tasks/ACTIVE_TASKS.md`

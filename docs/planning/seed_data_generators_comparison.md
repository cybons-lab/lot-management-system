# ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã®æ£²ã¿åˆ†ã‘

## ğŸ“… ä½œæˆæ—¥: 2025-11-24

---

## æ¦‚è¦

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯2ã¤ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ„ãƒ¼ãƒ«ãŒå­˜åœ¨ã—ã¾ã™ï¼š

1. **`seed_simulate_service.py`** - æœ¬ç•ªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚µãƒ¼ãƒ“ã‚¹
2. **`generate_test_data.py`** - ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

ã“ã‚Œã‚‰ã¯**ç•°ãªã‚‹ç›®çš„**ã§ä½¿ã„åˆ†ã‘ã‚‰ã‚Œã¦ãŠã‚Šã€**é‡è¤‡ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚

---

## 1. seed_simulate_service.py

### ğŸ“ å ´æ‰€
`backend/app/services/seed/seed_simulate_service.py`

### ğŸ¯ ç›®çš„
**æœ¬ç•ªç’°å¢ƒã«è¿‘ã„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ**

### ç‰¹å¾´

#### âœ… APIçµŒç”±ã§å®Ÿè¡Œ
```
POST /admin/simulate-seed-data
```

- FastAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆGUIï¼‰ã‹ã‚‰æ“ä½œå¯èƒ½
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã¨ã—ã¦éåŒæœŸå®Ÿè¡Œ

#### âœ… ç´°ã‹ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆ¶å¾¡
```python
class SimulateSeedRequest(BaseModel):
    profile: str | None          # small/medium/large_near
    random_seed: int | None      # å†ç¾æ€§ã®ãŸã‚ã®ã‚·ãƒ¼ãƒ‰
    warehouses: int = 2          # å€‰åº«æ•°ï¼ˆ1ã€œ10ï¼‰
    customers: int = 3           # é¡§å®¢æ•°
    suppliers: int = 2           # ä»•å…¥å…ˆæ•°
    products: int = 5            # è£½å“æ•°
    lots: int = 10               # ãƒ­ãƒƒãƒˆæ•°
    orders: int = 5              # å—æ³¨æ•°
    forecasts: int = 100         # äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿æ•°
    # ... ãã®ä»–å¤šæ•°ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
```

#### âœ… ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
```python
tracker.add_log(task_id, "Phase 1: Creating master data")
tracker.update_progress(task_id, JobPhase.MASTERS, 25)
```

- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§é€²æ—ã‚’è¿½è·¡
- GUIã§é€²æ—çŠ¶æ³ã‚’è¡¨ç¤ºå¯èƒ½
- ãƒ­ã‚°ã®è¨˜éŒ²

#### âœ… ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆæ©Ÿèƒ½
- ç”Ÿæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¨ã—ã¦ä¿å­˜
- å¾Œã‹ã‚‰å¾©å…ƒå¯èƒ½
- è¤‡æ•°ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä¿æŒ

### ä½¿ç”¨ã‚·ãƒ¼ãƒ³

| ã‚·ãƒ¼ãƒ³ | èª¬æ˜ |
|--------|------|
| **æœ¬ç•ªãƒ‡ãƒ¢** | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |
| **UIé–‹ç™º** | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºæ™‚ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ** | å¤§é‡ãƒ‡ãƒ¼ã‚¿ã§ã®å‹•ä½œç¢ºèª |
| **ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ** | ç‰¹å®šã®æ¥­å‹™ãƒ•ãƒ­ãƒ¼ã®æ¤œè¨¼ |

### å‘¼ã³å‡ºã—æ–¹æ³•

```bash
# 1. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ï¼ˆæ¨å¥¨ï¼‰
curl -X POST http://localhost:8000/api/admin/simulate-seed-data \
  -H "Content-Type: application/json" \
  -d '{
    "profile": "medium",
    "warehouses": 3,
    "products": 20,
    "orders": 50
  }'

# 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆç®¡ç†ç”»é¢ï¼‰ã‹ã‚‰å®Ÿè¡Œ
# http://localhost:5173/admin/simulate ã«ã‚¢ã‚¯ã‚»ã‚¹
```

---

## 2. generate_test_data.py

### ğŸ“ å ´æ‰€
`backend/scripts/generate_test_data.py`

### ğŸ¯ ç›®çš„
**Property-basedãƒ†ã‚¹ãƒˆã®ãŸã‚ã®ã‚·ãƒŠãƒªã‚ªãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ**

### ç‰¹å¾´

#### âœ… Hypothesisãƒ™ãƒ¼ã‚¹ã®æˆ¦ç•¥çš„ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
```python
@st.composite
def scenario_lot_strategy(draw, lot_id, product_id, warehouse_id,
                          supplier_id, scenario: str):
    """ç‰¹å®šã®ã‚·ãƒŠãƒªã‚ªã«åŸºã¥ã„ã¦ãƒ­ãƒƒãƒˆã‚’ç”Ÿæˆ."""
```

#### âœ… ã‚«ãƒãƒ¼ã™ã‚‹ã‚·ãƒŠãƒªã‚ª
```python
Scenarios:
1. Normal allocation (sufficient inventory)      # æ­£å¸¸ãªåœ¨åº«
2. Partial allocation (shortage)                 # åœ¨åº«ä¸è¶³
3. FEFO priority (expiring soon)                 # æœŸé™åˆ‡ã‚Œé–“è¿‘
4. Expired lots (should be excluded)             # æœŸé™åˆ‡ã‚Œ
5. Multiple lots per product                     # è¤‡æ•°ãƒ­ãƒƒãƒˆ
6. Zero inventory (depleted)                     # åœ¨åº«ã‚¼ãƒ­
```

#### âœ… ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å‘ã‘ã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ç”Ÿæˆ
- åœ¨åº«ä¸è¶³ã«ã‚ˆã‚‹éƒ¨åˆ†å¼•å½“
- æœŸé™åˆ‡ã‚Œãƒ­ãƒƒãƒˆã®é™¤å¤–
- FEFOï¼ˆå…ˆå…¥å…ˆå‡ºï¼‰ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ¤œè¨¼
- è¤‡æ•°å€‰åº«ãƒ»è¤‡æ•°ãƒ­ãƒƒãƒˆã®ã‚¢ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³

#### âœ… å›ºå®šãƒ‡ãƒ¼ã‚¿é‡ï¼ˆäºˆæ¸¬å¯èƒ½ï¼‰
```python
customers = [customer_strategy(customer_id=i+1).example() for i in range(3)]
products = [product_strategy(...).example() for i in range(5)]
warehouses = [warehouse_strategy(...).example() for i in range(2)]
```

### ä½¿ç”¨ã‚·ãƒ¼ãƒ³

| ã‚·ãƒ¼ãƒ³ | èª¬æ˜ |
|--------|------|
| **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ** | ç‰¹å®šã®ãƒ­ã‚¸ãƒƒã‚¯ã®æ¤œè¨¼ |
| **çµ±åˆãƒ†ã‚¹ãƒˆ** | APIå…¨ä½“ã®å‹•ä½œç¢ºèª |
| **å›å¸°ãƒ†ã‚¹ãƒˆ** | ãƒã‚°ä¿®æ­£å¾Œã®å†ãƒ†ã‚¹ãƒˆ |
| **é–‹ç™ºä¸­ã®ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ** | ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®å‹•ä½œç¢ºèª |

### å‘¼ã³å‡ºã—æ–¹æ³•

```bash
# ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ç›´æ¥å®Ÿè¡Œ
cd backend
python scripts/generate_test_data.py
```

**å‡ºåŠ›ä¾‹:**
```
============================================================
Property-Based Test Data Generator
============================================================

ğŸ—‘ï¸  Clearing database...
âœ“ Database cleared

ğŸ“¦ Creating master data...
âœ“ Created 3 customers
âœ“ Created 5 products
âœ“ Created 2 warehouses
...
âœ“ Generated 25 lots
âœ“ Generated 15 orders with 45 lines
âœ“ Created 120 forecasts

============================================================
âœ… Test data generation completed successfully!
============================================================
```

---

## 3. æ£²ã¿åˆ†ã‘ã®ç†ç”±

### ãªãœ2ã¤ã®ãƒ„ãƒ¼ãƒ«ãŒå¿…è¦ãªã®ã‹ï¼Ÿ

| è¦³ç‚¹ | seed_simulate_service.py | generate_test_data.py |
|------|-------------------------|----------------------|
| **ãƒ‡ãƒ¼ã‚¿ã®æ€§è³ª** | æœ¬ç•ªã«è¿‘ã„ãƒªã‚¢ãƒ«ãªãƒ‡ãƒ¼ã‚¿ | ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚’å«ã‚€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ |
| **ãƒ‡ãƒ¼ã‚¿é‡** | å¯å¤‰ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§åˆ¶å¾¡ï¼‰ | å›ºå®šï¼ˆäºˆæ¸¬å¯èƒ½ï¼‰ |
| **ãƒ©ãƒ³ãƒ€ãƒ æ€§** | é«˜ã„ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é‡è¦–ï¼‰ | ä½ã„ï¼ˆå†ç¾æ€§é‡è¦–ï¼‰ |
| **å®Ÿè¡Œæ™‚é–“** | é•·ã„ï¼ˆæ•°ç§’ã€œæ•°åˆ†ï¼‰ | çŸ­ã„ï¼ˆæ•°ç§’ï¼‰ |
| **åˆ¶å¾¡æ–¹æ³•** | GUI/API | CLI |
| **ä¸»ãªç”¨é€”** | ãƒ‡ãƒ¢ãƒ»UIé–‹ç™º | ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ |

### å…·ä½“ä¾‹ï¼šåœ¨åº«ä¸è¶³ã‚·ãƒŠãƒªã‚ª

#### seed_simulate_service.py
```python
# ãƒ©ãƒ³ãƒ€ãƒ ã«åœ¨åº«ä¸è¶³ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
# ã€Œãƒªã‚¢ãƒ«ãªæ¥­å‹™ã€ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
for _ in range(random.randint(10, 100)):
    lot = create_random_lot()
    # è‡ªç„¶ã«åœ¨åº«ä¸è¶³ãŒç™ºç”Ÿã™ã‚‹å ´åˆã‚‚ã‚ã‚‹
```

#### generate_test_data.py
```python
# æ„å›³çš„ã«åœ¨åº«ä¸è¶³ã‚’ä½œã‚Šå‡ºã™
# ã€ŒFEFO ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹ã€ã‚’ãƒ†ã‚¹ãƒˆ
lot = scenario_lot_strategy(scenario='shortage').example()
# ç¢ºå®Ÿã«åœ¨åº«ä¸è¶³ã®ã‚±ãƒ¼ã‚¹ã‚’ç”Ÿæˆ
```

---

## 4. å…±é€šåŒ–ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®

### âœ… äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯

**2025-11-24ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Œäº†ï¼**

ä¸¡æ–¹ã®ãƒ„ãƒ¼ãƒ«ãŒä»¥ä¸‹ã®å…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ï¼š

```python
# backend/app/services/forecasts/forecast_generator.py
from app.services.forecasts.forecast_generator import (
    create_daily_forecasts,
    create_jyun_forecasts_from_daily,
    create_monthly_forecasts_from_daily,
)
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- âœ… Single Source of Truthï¼ˆå˜ä¸€ã®çœŸå®Ÿï¼‰
- âœ… ãƒã‚°ä¿®æ­£ãŒ1ç®‡æ‰€ã§æ¸ˆã‚€
- âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¨æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã®ä¸€è²«æ€§

**è©³ç´°:** `docs/forecast_data_generation_refactor.md` ã‚’å‚ç…§

---

## 5. ã©ã¡ã‚‰ã‚’ä½¿ã†ã¹ãã‹ï¼Ÿ

### ğŸ” åˆ¤æ–­ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

```
è³ªå•: ä½•ã‚’ã—ãŸã„ã§ã™ã‹ï¼Ÿ

â”œâ”€ [A] UIé–‹ç™ºãƒ»ãƒ‡ãƒ¢ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
â”‚   â””â†’ âœ… seed_simulate_service.py (APIçµŒç”±)
â”‚
â”œâ”€ [B] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â””â†’ âœ… generate_test_data.py (CLI)
â”‚
â”œâ”€ [C] ç‰¹å®šã®ãƒã‚°å†ç¾ï¼ˆåœ¨åº«ä¸è¶³ãªã©ï¼‰
â”‚   â””â†’ âœ… generate_test_data.py (ã‚·ãƒŠãƒªã‚ªæŒ‡å®š)
â”‚
â”œâ”€ [D] å¤§é‡ãƒ‡ãƒ¼ã‚¿ã§ã®è² è·ãƒ†ã‚¹ãƒˆ
â”‚   â””â†’ âœ… seed_simulate_service.py (ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´)
â”‚
â””â”€ [E] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
    â””â†’ âœ… generate_test_data.py (é«˜é€Ÿãƒ»å®‰å®š)
```

---

## 6. ä»Šå¾Œã®æ–¹å‘æ€§

### ç¾çŠ¶ç¶­æŒï¼ˆæ¨å¥¨ï¼‰

**ç†ç”±:**
- æ˜ç¢ºãªæ£²ã¿åˆ†ã‘ãŒã§ãã¦ã„ã‚‹
- ãã‚Œãã‚ŒãŒç•°ãªã‚‹ãƒ‹ãƒ¼ã‚ºã«å¯¾å¿œ
- é‡è¤‡ã‚³ãƒ¼ãƒ‰ã¯æ—¢ã«å…±é€šåŒ–æ¸ˆã¿ï¼ˆforecast_generator.pyï¼‰

### ä»Šå¾Œã®æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ

#### 1. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™
- [ ] README.mdã«2ã¤ã®ãƒ„ãƒ¼ãƒ«ã®ä½¿ã„åˆ†ã‘ã‚’è¿½è¨˜
- [ ] SETUP_GUIDE.mdã«ä½¿ç”¨ä¾‹ã‚’è¿½åŠ 

#### 2. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š
- [ ] generate_test_data.pyã§ç”Ÿæˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ãŸè‡ªå‹•ãƒ†ã‚¹ãƒˆ
- [ ] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®çµ„ã¿è¾¼ã¿

#### 3. generate_test_data.pyã®æ‹¡å¼µ
- [ ] ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã§ã‚·ãƒŠãƒªã‚ªã‚’é¸æŠå¯èƒ½ã«
- [ ] `--scenario=shortage` ãªã©ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ 

```bash
# å°†æ¥çš„ãªæ‹¡å¼µæ¡ˆ
python scripts/generate_test_data.py --scenario=shortage
python scripts/generate_test_data.py --scenario=expiring
python scripts/generate_test_data.py --scenario=all
```

---

## 7. å‚è€ƒè³‡æ–™

- **seed_simulate_service.py**: `backend/app/services/seed/seed_simulate_service.py`
- **generate_test_data.py**: `backend/scripts/generate_test_data.py`
- **å…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**: `backend/app/services/forecasts/forecast_generator.py`
- **APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `backend/app/api/routes/admin/admin_simulate_router.py`
- **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨˜éŒ²**: `docs/forecast_data_generation_refactor.md`

---

## ã¾ã¨ã‚

| é …ç›® | seed_simulate_service | generate_test_data |
|------|-----------------------|-------------------|
| **ç›®çš„** | æœ¬ç•ªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª |
| **å®Ÿè¡Œæ–¹æ³•** | API/GUI | CLI |
| **ãƒ‡ãƒ¼ã‚¿ç‰¹æ€§** | ãƒªã‚¢ãƒ«ãƒ»å¤§é‡ | ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ |
| **ä¸»ãªç”¨é€”** | ãƒ‡ãƒ¢ãƒ»UIé–‹ç™º | ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ |
| **åˆ¶å¾¡æ€§** | é«˜ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤šæ•°ï¼‰ | ä¸­ï¼ˆã‚·ãƒŠãƒªã‚ªå›ºå®šï¼‰ |
| **å®Ÿè¡Œæ™‚é–“** | é•·ã„ | çŸ­ã„ |

**çµè«–:** ä¸¡æ–¹ã¨ã‚‚å¿…è¦ã€‚çµ±åˆã®å¿…è¦ãªã—ã€‚å…±é€šåŒ–ã§ãã‚‹éƒ¨åˆ†ã¯æ—¢ã«å…±é€šåŒ–æ¸ˆã¿ã€‚

---

æœ€çµ‚æ›´æ–°: 2025-11-24

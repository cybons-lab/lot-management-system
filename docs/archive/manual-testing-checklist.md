# マニュアルテストチェックリスト - フロントエンドデータ同期修正

## テスト実施日時
- 日付: _____________
- テスター: _____________
- ブランチ: `claude/fix-frontend-data-sync-01DKjfdDf9JYk2YuoNge8BtL`

---

## ✅ 問題1: フォーキャスト編集の画面反映

### テストケース 1-1: 日別フォーキャストの編集・即時反映

**前提条件:**
- フォーキャストリスト画面（/forecasts）にアクセス
- 既存のフォーキャストグループが表示されている

**手順:**
1. フォーキャストカードを展開
2. 任意の日付セルをダブルクリック
3. 数量を変更（例: 100 → 200）
4. Enter キーで保存

**期待結果:**
- ✅ トースト通知「フォーキャストを更新しました」が表示される
- ✅ 同一カード内の数値が即座に **200** に変化する
- ✅ 月合計、旬別合計が即時更新される
- ✅ ページリロードなしで変更が反映される
- ✅ ブラウザコンソールに console.log が出力されない

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

### テストケース 1-2: フォーキャスト新規作成

**手順:**
1. フォーキャストカードを展開
2. 空の日付セルをダブルクリック
3. 数量を入力（例: 150）
4. Enter キーで保存

**期待結果:**
- ✅ トースト通知「フォーキャストを作成しました」が表示される
- ✅ 入力した値 **150** が即座にセルに表示される
- ✅ 旬別・月別合計が更新される

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

### テストケース 1-3: フォーキャスト削除（0入力）

**手順:**
1. 既存のフォーキャストセルをダブルクリック
2. 数量を **0** に変更
3. Enter キーで保存

**期待結果:**
- ✅ トースト通知「フォーキャストを削除しました」が表示される
- ✅ セルが空白に戻る
- ✅ 合計値が即時更新される

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

## ✅ 問題2: 主担当（primary owner）表示・フィルタ

### 前提: 主担当データの準備

**事前準備:**
1. ログイン中のユーザーに主担当仕入先を割り当てておく
2. 管理画面（/assignments/primary）で確認
3. 複数の仕入先があることを確認（主担当 + 非主担当）

---

### テストケース 2-1: 受注一覧 - 主担当フィルタUI確認

**手順:**
1. 受注一覧画面（/orders）にアクセス
2. フィルタセクションを確認

**期待結果:**
- ✅ 「主担当の仕入先のみ」チェックボックスが表示される
- ✅ チェックボックスの横に Crown アイコンが表示される
- ✅ チェックボックスはデフォルトで **OFF** になっている

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

### テストケース 2-2: 受注一覧 - 主担当フィルタ動作

**手順:**
1. 受注一覧で「主担当の仕入先のみ」にチェック
2. データが再読み込みされることを確認

**期待結果:**
- ✅ チェックON: 主担当の仕入先に関連する受注のみ表示される
- ✅ チェックOFF: すべての受注が表示される
- ✅ リクエストURLに `prioritize_primary=true` パラメータが含まれる（DevTools Network タブで確認）

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

### テストケース 2-3: 在庫一覧 - 主担当フィルタUI確認

**手順:**
1. 在庫管理画面（/inventory）にアクセス
2. 「アイテム一覧」タブを選択
3. フィルタセクションを確認

**期待結果:**
- ✅ 「主担当の仕入先のみ」チェックボックスが表示される
- ✅ Crown アイコンが表示される

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

### テストケース 2-4: 在庫一覧 - 主担当フィルタ動作

**手順:**
1. 在庫一覧で「主担当の仕入先のみ」にチェック
2. データが再読み込みされることを確認

**期待結果:**
- ✅ チェックON: 主担当仕入先の在庫のみ表示
- ✅ チェックOFF: すべての在庫が表示
- ✅ リクエストURLに `prioritize_primary=true` パラメータが含まれる

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

### テストケース 2-5: 主担当バッジ表示確認

**手順:**
1. 在庫管理画面（/inventory）で「仕入先別」タブを選択
2. 仕入先リストを確認

**期待結果:**
- ✅ 主担当の仕入先に「主担当」バッジ（Crown アイコン + 黄色背景）が表示される
- ✅ 非主担当の仕入先にはバッジが表示されない

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

## ✅ 問題3: ロット引当の即時反映

### テストケース 3-1: 引当実行 → 在庫一覧の即時更新

**前提条件:**
- 受注明細がある（/orders/{order_id}）
- 引当可能なロットが存在する

**手順:**
1. 受注詳細画面で引当パネルを開く
2. ロット候補から数量を入力（例: 50）
3. 「仮引当」ボタンをクリック
4. **別タブ/別ウィンドウ** で在庫管理画面（/inventory）を開く

**期待結果:**
- ✅ 引当実行後、トースト通知が表示される
- ✅ 在庫管理画面（/inventory）の **利用可能在庫数** が即時減少する（手動リフレッシュ不要）
- ✅ **引当済在庫数** が即時増加する
- ✅ 在庫テーブルの「仮引当」列が更新される

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

### テストケース 3-2: 引当実行 → 引当一覧の即時追加

**手順:**
1. 受注詳細画面で引当実行（テストケース 3-1 と同様）
2. 引当一覧画面（/allocations）を確認

**期待結果:**
- ✅ 引当一覧に新しい行が即座に追加される
- ✅ ステータスが「仮引当完了」（Indigo色バッジ）で表示される
- ✅ 引当数量が正しく表示される

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

### テストケース 3-3: 仮引当 → 確定 → UI状態変化

**手順:**
1. 仮引当状態の受注明細を開く
2. 引当パネルで「確定」ボタンをクリック

**期待結果:**
- ✅ バッジが「仮引当完了」（Indigo） → 「引当確定」（Green）に変化
- ✅ プログレスバーの色が Amber → Green に変化
- ✅ 受注一覧画面で該当受注の引当状態が更新される

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

### テストケース 3-4: 引当実行 → ダッシュボード統計の即時更新

**手順:**
1. ダッシュボード画面（/）を開く
2. 初期の「引当率」「未引当受注」数を記録
3. 受注詳細で引当を実行
4. ダッシュボードに戻る

**期待結果:**
- ✅ **引当率** が即座に更新される（手動リフレッシュ不要）
- ✅ **未引当受注** 数が減少する
- ✅ 統計カードの値が正しく反映される

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

### テストケース 3-5: 引当キャンセル → 在庫復元の即時反映

**手順:**
1. 引当済の受注明細を開く
2. 引当パネルで「取消」ボタンをクリック
3. 在庫管理画面を確認

**期待結果:**
- ✅ トースト通知「引当を取消しました」が表示される
- ✅ 在庫管理画面の **利用可能在庫数** が即座に増加する
- ✅ **引当済在庫数** が即座に減少する
- ✅ 引当一覧から該当行が消える

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

### テストケース 3-6: 複数画面同時表示での同期確認

**手順:**
1. ブラウザで以下の画面を **複数タブ** で開く:
   - 受注詳細（引当パネル表示）
   - 在庫管理画面
   - ダッシュボード
2. 受注詳細タブで引当を実行
3. 他のタブに切り替える（リフレッシュせず）

**期待結果:**
- ✅ すべてのタブで数値が自動的に更新される（リアルタイム同期）
- ✅ 在庫数、引当数、ダッシュボード統計が整合している

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

## ✅ 追加確認: 関連機能の非破壊性

### テストケース 4-1: 既存テストの実行

**手順:**
```bash
cd frontend
npm run typecheck
npm run lint
```

**期待結果:**
- ✅ TypeScript エラーが **0** 件
- ✅ ESLint エラーが **0** 件

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

### テストケース 4-2: フォーキャスト自動引当機能

**手順:**
1. フォーキャスト詳細カードで「自動引当」ボタンをクリック
2. 引当一覧を確認

**期待結果:**
- ✅ 自動引当が実行される
- ✅ トースト通知が表示される
- ✅ 在庫・受注データが即時更新される

**結果:** [ ] PASS / [ ] FAIL
**備考:** _____________________________________________

---

## 📝 総合評価

### 実施結果サマリー

- **総テスト数:** 17
- **PASS:** ___ / 17
- **FAIL:** ___ / 17

### 不具合・問題点（あれば記載）

1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

### 承認

- [ ] すべてのテストが PASS
- [ ] 修正が正しく動作していることを確認
- [ ] バックエンドとの整合性が取れている

**承認者:** _______________
**日付:** _______________

= 残課題リスト
:toc: left
:toc-title: 目次

**最終更新:** 2025-12-05

== 概要

このドキュメントは現在の残課題のみを管理します。
完了した課題は `CHANGELOG.md` に記録されます。

---

== 🟠 高優先度

=== 1. 認証機能（ユーザー識別用）

**ステータス:** 保留（アクセス制限不要のため優先度降格）

社内システムのため、ログイン必須ではありませんが、
「誰が操作したか」の記録があると便利です。

**サブタスク:**

. ユーザー識別方法の決定
. Auth context 実装
. 操作ログへのユーザー関連付け

---

=== 2. 担当者ロック表示（排他制御）

**ステータス:** 未実装 +
**ブロッカー:** 認証機能の実装

別ユーザーが編集中の場合、「🔒 田中太郎さんが編集中」と表示。

---

== 🟡 中優先度

=== 3. SAP連携の本番化

**ステータス:** モック実装済み

* SAP在庫チェック: ✅ モック実装済み
* SAP受注登録: ✅ モック実装済み
* 本番SAP API接続: ❌ 未実装

---

=== 4. 定期バッチジョブのスケジューラ設定

**ステータス:** 手動実行のみ

APScheduler または Celery Beat の導入検討。

---

=== 5. UIレイアウト総点検

長い文字列の表示で一部レイアウト崩れが発生する可能性。
各一覧画面での確認が必要。

---

== 🔵 低優先度

=== 6. Hard Allocation の本格運用

**ステータス:** v3.0予定

現在はSoft Allocation（推奨引当）のみ。

=== 7. 在庫管理ページ Soft/Hard 引当表示

**ステータス:** 未実装 +
**追加日:** 2025-12-05

在庫管理ページで「引当済」を「仮引当(Soft)」と「確定引当(Hard)」に分割表示する。
バックエンドAPIの拡張が必要。

**サブタスク:**

. `InventoryItemResponse` に `soft_allocated_quantity`, `hard_allocated_quantity` 追加
. `InventoryService.get_inventory_items()` で allocations テーブル集計
. フロントエンド `InventoryTable` 列追加

=== 8. テストデータ生成の改善

**ステータス:** 一部完了 +
**追加日:** 2025-12-05

テストデータ生成で既に対応済み:

* ✅ 在庫量: フォーキャストの70-90%（制約発生）
* ✅ ロット: 60% 1ロット、30% 2ロット、10% 3ロット
* ✅ フォーキャスト種別: 50% 日別、30% 旬別、20% 月別
* ✅ 受注: 90%がフォーキャスト一致、10%のみ変動

残タスク（別ブランチで対応予定）:

* 全製品に最低1ロット確保
* エッジケーステスト用データパターン追加

=== 9. レガシー AllocationService の削除

`backend/app/services/allocations/core.py` は孤立コード。

=== 10. mypy attr-defined エラー

17件残（MetricsCollector関連15件、Enum2件）

---

== コード品質課題

=== ESLint

**Critical:** ✅ 全完了（2025-12-05）

**eslint-disable コメント:** 38件

一時的にLintエラーを無視しているファイル。
将来的にリファクタリングして削除する。

.検索コマンド
[source,bash]
----
grep -rn "eslint-disable" --include="*.tsx" --include="*.ts" frontend/src/
----

**主な課題:**

* max-lines-per-function 違反: 約20件
* complexity 違反: 約8件
* @typescript-eslint/no-explicit-any: 約8件
* jsx-a11y: 2件

**High（将来対応）:**

* アクセシビリティ（ラベル関連付け）: 6件
* 関数長さ違反（80行超過）: 17件
* 複雑度違反: 15件

=== Backend Type Checks (Mypy)

**# type: ignore 使用箇所:** 約30ファイル

主な要因:
* 動的な属性アクセス (SQLAlchemy/Pydantic)
* 循環参照回避
* 外部ライブラリの型定義不足

**要注意ファイル:**
* `backend/app/services/allocations/core.py` (レガシーコード?)
* `backend/app/services/allocations/utils.py`
* `backend/app/services/inventory/inbound_service.py`
* `backend/app/api/routes/inventory/lots_router.py`

---

== 更新履歴

[cols="1,2"]
|===
| 日付 | 内容

| 2025-12-05
| ドキュメント構造整理。完了済み課題をCHANGELOGへ移動。

| 2025-12-04
| OpenAPI型統一完了

| 2025-11-28
| 最終精査版作成
|===

# コードレビュー指摘事項に関する意思決定 (2026-01-18)

## 概要
2026-01-18の重点レビューで指摘された事項のうち、ドキュメントと実装の乖離、および仕様が明文化されていなかった項目についての意思決定を記録する。

## 1. アラート条件と実装のステータス不一致 (レビュー項目 No.4)

### 課題
アラート収集処理 (`AlertService.collect_order_alerts`) のコメントにおいて、「status=pending」と記述されているが、実装では `Order.status == "open"` を判定条件としている。
プロジェクト内のドキュメントを調査したが、`pending` ステータスに関する定義は発見されず、`open` ステータスが正しい実装であると判断される。

### 決定事項
*   **実装を正とする**: コードの動作 (`Order.status == "open"`) を正しい挙動とし、変更しない。
*   **コメントの修正**: 誤解を招くコメント `status=pending` を `status=open` に修正する。

---

## 2. 自動引当失敗時の挙動 (レビュー項目 No.7)

### 課題
`OrderService.create_order` 内で行われる自動引当処理 (`auto_reserve_line`) が失敗した場合、警告ログを出力するのみで処理を続行し、トランザクションをロールバックしない実装となっている。
この挙動（サイレント失敗）に関する仕様書やドキュメントが存在しない。

### 決定事項
*   **現状維持**: 現時点では、引当失敗によって受注作成自体を失敗させるべきか、あるいは「一部引当失敗」状態を設けるべきかの業務要件が明確ではない。
*   **ログ監視**: 警告ログ (`WARNING`) レベルで出力されているため、監視運用での検知は可能であるとし、今回の修正範囲には含めない。
*   **将来的な対応**: 厳密な在庫管理が必要となった段階で、失敗時のリトライ機構や通知、あるいはステータスによる明示的な管理（`partial_allocated` 等への遷移失敗扱いなど）を検討する。

# テストデータ生成・発注提案・需要予測 統合マスタープラン

**区分:** 実行計画（マスタープラン）  
**バージョン**: v1.3  
**更新日**: 2026-01-24  
**ステータス**: Draft

---

## 概要
本ドキュメントは、テストデータ生成、発注提案、需要予測、および基礎マスタ/マッピングデータの生成方針を統合したマスタープランである。業務フローの起点から分析・予測までを網羅し、一貫性のある検証環境の構築を目的とする。

## 対象範囲

| データ領域 | 主な内容 | 目的 |
| --- | --- | --- |
| **オリジナル (マスタ)** | 顧客、仕入先、製品、倉庫、単位換算 | 基礎データの安定供給 |
| **マッピング** | 得意先品番、仕入先別製品、次区マッピング | 業務ルールの整合性検証 |
| **受注・入荷** | 受注(Orders)、入荷予定(Inbound Plans) | 業務フローのシミュレーション |
| **在庫・出庫** | ロット、出庫履歴(Withdrawals) | 在庫推移と需要実績の生成 |
| **発注・予測** | 需要予測、発注点(ROP)、発注提案 | 高度分析機能の検証 |

---

## 設計原則

### 1. データセットモード (3モード分離)
破壊データを通常セットに混入させず、用途に応じてモードを切り替える。
- **strict**: 参照整合性100%。CI/通常テスト用。
- **relaxed**: 一部警告（マッピング未設定、納期遅延等）を許容。例外処理検証用。
- **invalid_only**: 破壊データ（FK違反、マイナス在庫等）のみ。異常系テスト用。

### 2. 再現性の保証
シード値 (`seed: 42`) と基準日 (`base_date`) を固定し、日付依存ロジックを含めた完全な再現性を確保する。

---

## データ生成方針

### 基礎マスタ & マッピング
- **外部コード一意性**: 顧客・製品コード等のユニーク制約と桁数ルールを維持。
- **マッピング整合性**: 得意先品番マッピングと納入先（次区）を連動させ、仕入先別製品設定（リードタイム含）を網羅する。

### 需要 & 発注シミュレーション
- **需要パターン**: 定常、成長/減少トレンド、季節性（夏季/冬季ピーク）、週次パターン、スパイク需要をサポート。
- **出庫タグ付け**: `ORDER_AUTO` / `MANUAL` を需要、`DISPOSAL` / `SAMPLE` 等を非需要として区別し、予測精度の検証を可能にする。
- **リードタイム充足**: 計画LTに対する実績LTのばらつき（早着、遅延）を再現し、安全在庫計算の妥当性を検証する。

---

## 需要予測 & 発注提案ロジック (Phase別導入)

### Phase B: 統計ベース (初期実装)
- **需要予測**: 移動平均、EWMA (指数平滑移動平均)、季節係数を用いた予測。
- **発注提案**: 安全在庫（需要変動+LT変動考慮）を加味した発注点 (ROP) 方式。
- **説明可能性**: なしで「なぜその量になったか」を人が読める形式で出力する機能。

### Phase C: 機械学習 (将来)
- データ蓄積後、統計ベースの予測器をMLモデルへ差し替え可能とするインターフェース設計。

---

## 実装ロードマップ

1. **Phase 1**: オリジナルデータ & マッピング生成器。
2. **Phase 2**: 受注・入荷予定・出庫履歴の生成（時系列対応）。
3. **Phase 3**: 需要予測エンジン（統計ベース）の実装。
4. **Phase 4**: 発注提案エンジン & 説明生成機能。
5. **Phase 5**: 検証SQLとCIへの組み込み。

= 予測管理機能
:toc: left
:toc-title: 目次

**最終更新:** 2025-11-30 +
**ステータス:** ✅ 実装完了

NOTE: 詳細設計・実装コードは `backend/app/services/forecasts/` と `frontend/src/features/forecasts/` を参照してください。

== 機能概要

* 顧客別・製品別・納品先別の需要予測管理
* 日次予測データの管理
* 予測と実績の比較
* 予測インポート機能（CSV/API）

== 主要機能

=== 1. 予測データ管理

* 日次予測（`forecast_date`）
* 月次集計（`forecast_period`: YYYY-MM）
* 旬別表示（1-10日、11-20日、21-月末）

=== 2. 在庫サマリー統合

* 現在在庫
* 引当済み数量
* 入荷予定
* 予測対比での充足率

=== 3. SAP連携（モック）

* SAP在庫トータルチェック（日次バッチ）
* SAP受注登録
* 在庫差異アラート

== データモデル

=== forecast_current テーブル

最新の予測データを保持

[cols=\"1,1,1\"]
|===
| カラム | 型 | 説明

| id | BigInteger | PK
| forecast_date | Date | 予測対象日
| forecast_period | String(7) | 予測期間（YYYY-MM）
| customer_id | BigInteger | 顧客ID
| product_id | BigInteger | 製品ID
| delivery_place_id | BigInteger | 納品先ID
| quantity | Decimal | 予測数量
|===

=== forecast_history テーブル

過去の予測データを履歴として保持

== API仕様

=== 予測インポート

`POST /forecasts/bulk-import`

* CSVまたはJSON形式で複数行を一括登録
* 既存データは `forecast_history` に移動
* 引当推奨を自動再生成

=== 予測一覧取得

`GET /forecasts`

* 期間、顧客、製品でフィルタリング可能
* 旬別・月別の集計をサポート

== UI機能

=== 予測詳細カード

* 集約表示（月次 / 旬別）
* 日次詳細表示（展開可能）
* 在庫サマリー統合表示
* 入荷予定表示

=== 予測一覧画面

* フィルタリング機能
* 一括インポート
* 引当推奨生成ボタン

== 参照

* **実装コード**
** Backend: `backend/app/services/forecasts/`
** Frontend: `frontend/src/features/forecasts/`
* **モデル定義:** `backend/app/models/forecast_models.py`
* **API仕様:** `docs/api_reference.adoc`

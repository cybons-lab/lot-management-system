# フロントエンド UI カバレッジ調査 & 実装方針

最終更新: 2025-11-16
対象: Lot-management-system フロントエンド

---

## 1. このドキュメントの目的

- バックエンド API とフロントエンド UI の **カバレッジ状況を可視化** する
- 追加したスケルトンページの一覧と役割を **1か所に集約** する
- 今後の実装を **フェーズ単位で整理** し、どこから肉付けしていくかの方針を明文化する
- AI（Claude / ChatGPT 等）にフロント実装を任せる際の **共通の参照資料** とする

---

## 2. 現状サマリ

### 2.1 バックエンド API カバレッジ概要

- バックエンド API エンドポイント数: **179 個**（OpenAPI / docs ベース）
- フロントエンド ページ数:
  - 変更前: **25 ページ**（API カバレッジ 約 **14%**）
  - 変更後: **39 ページ**（API カバレッジ 約 **22%**）
  - 今回新規追加: **14 ページ**（すべて「スケルトン」実装）

> メモ:
> 現時点では「主要ドメインへのUI入口」が増えた段階であり、
> 各ページの機能はこれから段階的に実装していく。

---

## 3. 新規スケルトンページ一覧

### 3.1 マスタデータ管理（4ページ）

マスタデータ（倉庫・仕入先・得意先・製品）を UI から管理するための画面群。

| ページ名       | ルート                   | 主な役割                        | 状態       |
|----------------|--------------------------|----------------------------------|------------|
| `WarehousesPage` | `/masters/warehouses`  | 倉庫マスタの一覧・管理          | スケルトン |
| `SuppliersPage`  | `/masters/suppliers`   | 仕入先マスタの一覧・管理        | スケルトン |
| `CustomersPage`  | `/masters/customers`   | 得意先マスタの一覧・管理        | スケルトン |
| `ProductsPage`   | `/masters/products`    | 製品マスタの一覧・管理          | スケルトン |

**現在の共通仕様**

- ページタイトル + 簡単な説明文
- "Coming Soon" プレースホルダー
- `shadcn/ui` の `Button` コンポーネントを利用
- まだ API 呼び出しやフォームロジックは未実装

---

### 3.2 詳細ページ（2ページ）

ロット・受注の詳細情報を確認・編集するための画面。

| ページ名         | ルート                          | 主な役割                               | 状態       |
|------------------|---------------------------------|-----------------------------------------|------------|
| `LotDetailPage`   | `/inventory/lots/:lotId`       | ロット詳細、在庫変動履歴、引当状況表示 | スケルトン |
| `OrderDetailPage` | `/orders/:orderId`             | 受注ヘッダ・明細・ステータス管理       | スケルトン |

**現在の共通仕様**

- URL パラメータ（`lotId` / `orderId`）を型付きで取得
- タイトル + "Coming Soon" 表示のみ
- タブやテーブルなどは未実装（今後のフェーズで追加）

---

### 3.3 作成 / 編集ページ（4ページ）

フォーキャスト・入荷予定を登録・編集するための入力画面。

| ページ名                | ルート                            | 主な役割                         | 状態       |
|-------------------------|-----------------------------------|----------------------------------|------------|
| `ForecastCreatePage`    | `/forecasts/new`                  | フォーキャスト新規作成          | スケルトン |
| `ForecastEditPage`      | `/forecasts/:id/edit`             | フォーキャスト編集              | スケルトン |
| `InboundPlanCreatePage` | `/inbound-plans/new`              | 入荷予定新規作成                | スケルトン |
| `InboundPlanEditPage`   | `/inbound-plans/:id/edit`         | 入荷予定編集                    | スケルトン |

**現在の共通仕様**

- URL パラメータ (`id`) を取得（編集画面）
- フォーム項目のプレースホルダーテキストレベルのみ
- 具体的な入力項目・バリデーション・API連携は未実装

---

### 3.4 その他の管理・監査系画面（4ページ）

運用・監査・検証を支えるための管理ツール群。

| ページ名                   | ルート                         | 主な役割                                           | 状態       |
|----------------------------|--------------------------------|----------------------------------------------------|------------|
| `AllocationSuggestionsPage` | `/allocations/suggestions`    | 引当推奨の一覧・生成・削除の管理                   | スケルトン |
| `MastersBulkLoadPage`       | `/masters/bulk-load`          | マスタ一括登録（CSVアップロード）                 | スケルトン |
| `MasterChangeLogsPage`      | `/admin/master-change-logs`   | マスタ変更履歴の一覧・差分確認・CSV 出力          | スケルトン |
| `SeedSnapshotsPage`         | `/admin/seed-snapshots`       | Seed スナップショットの一覧・作成・復元・削除     | スケルトン |

**現在の共通仕様**

- タイトル + 説明 + "Coming Soon"
- ボタンだけが置かれている程度（実際の動作は未実装）

---

### 3.5 ルーティング・共通設定

- `frontend/src/constants/routes.ts`
  - 上記 14 ページ用のルート定数を追加済み
- `frontend/src/App.tsx`
  - すべての新規ページコンポーネントをルートとして登録済み
- 現時点で `npm run build` が通ることを確認済み
  （型定義や import はスケルトンとして成立する状態）

---

## 4. フェーズ別 実装方針

ここから先は、スケルトンに「肉付け」していくための中期ロードマップ。

### 4.1 Phase 0: 共通 UI 基盤の整備

**目的**

- 各ページでバラバラに実装されないよう、共通の UI パターンを先に用意する

**スコープ**

- 一覧 + フィルタ + ページネーションの共通テーブルコンポーネント
- フォーム用の共通部品
  - layout（2カラム/1カラム）
  - `react-hook-form + Zod` を使った型付きフォーム
  - 共通バリデーションメッセージ表示
- 確認ダイアログ・モーダルの共通コンポーネント

**完了条件（Definition of Done）**

- [ ] 共通テーブルコンポーネントを 1 つ以上のページで実戦投入
- [ ] 共通フォームコンポーネントを 1 ページ以上で利用
- [ ] 今後追加するページで「このパターンを使う」という方針が固まっている

---

### 4.2 Phase 1: マスタ CRUD 実装

対象ページ:

- `WarehousesPage`
- `SuppliersPage`
- `CustomersPage`
- `ProductsPage`

**目的**

- DB を直接触らなくても、倉庫・仕入先・得意先・製品を UI から管理できる状態にする

**各ページの TODO（テンプレ）**

共通:

- [ ] 一覧テーブル + フィルタ（コード / 名称 / 有効フラグ 等）
- [ ] 新規作成 / 編集ダイアログ（`react-hook-form + Zod`）
- [ ] 作成 / 更新 / 削除 API に接続
- [ ] 成功 / 失敗時のトースト（通知）

ページ別（例）:

- `ProductsPage`
  - [ ] 単位・カテゴリ・得意先関連フィールドなど、製品特有の項目を反映
  - [ ] 得意先との紐付けがある場合、参照 UI を検討
- `CustomersPage`
  - [ ] 得意先コード・名称・請求情報など必須項目の定義
- `SuppliersPage`
  - [ ] 仕入先コード・名称・連絡先など
- `WarehousesPage`
  - [ ] 倉庫コード・名称・所在地・有効/無効フラグなど

---

### 4.3 Phase 2: 在庫・受注の「見える化」

対象ページ:

- `LotDetailPage`
- `OrderDetailPage`
- （必要に応じて）`/inventory/moves` 既存ページの拡張

**目的**

- ロット / 受注の状態や履歴を UI から追えるようにする
- 在庫調査やトラブルシュートの起点を UI で提供する

**LotDetailPage TODO**

- [ ] ロット基本情報カード（ロット番号、製品、倉庫、数量、状態など）
- [ ] タブ構成の実装
  - [ ] 基本情報
  - [ ] 在庫変動履歴（Moves）
  - [ ] 引当状況（Allocations）
- [ ] 在庫変動履歴テーブルの実装
- [ ] ロット削除 / 無効化ボタン（必要なら）

**OrderDetailPage TODO**

- [ ] 受注ヘッダ情報カード（得意先、納期、ステータス等）
- [ ] 受注明細テーブル（製品・数量・引当状況）
- [ ] ステータスバッジ + ステータス更新アクション（ドラフト→確定など）
- [ ] 引当画面への遷移ボタン（既存の引当画面との連携）

---

### 4.4 Phase 3: 計画系（フォーキャスト / 入荷予定）

対象ページ:

- `ForecastCreatePage`, `ForecastEditPage`
- `InboundPlanCreatePage`, `InboundPlanEditPage`

**目的**

- 需要（フォーキャスト）・供給（入荷予定）を UI で登録し、
  引当ロジックの前提データを整備できるようにする。

**共通 TODO**

- [ ] ヘッダフォーム（得意先 / 仕入先 / 倉庫 / 日付範囲 等）
- [ ] 明細テーブル
  - [ ] 行追加 / 削除
  - [ ] inline editing
- [ ] 製品オートコンプリート
- [ ] バリデーション（数量、日付、必須チェック）

---

### 4.5 Phase 4: 管理・監査・検証ツール

対象ページ:

- `AllocationSuggestionsPage`
- `MastersBulkLoadPage`
- `MasterChangeLogsPage`
- `SeedSnapshotsPage`

**目的**

- 運用者・開発者向けの管理機能を UI で提供し、
  日々の運用や検証、監査対応を楽にする。

**各ページの概要 TODO**

`AllocationSuggestionsPage`

- [ ] フィルタフォーム（フォーキャスト明細ID、製品、日付範囲 等）
- [ ] 推奨一覧テーブル
- [ ] 一括生成ボタン（ジョブ起動やAPI連携）
- [ ] 削除ボタン

`MastersBulkLoadPage`

- [ ] ファイルアップロード（CSV）
- [ ] フォーマット説明 & サンプルダウンロード
- [ ] アップロード結果プレビュー
- [ ] 登録実行 + エラー表示

`MasterChangeLogsPage`

- [ ] フィルタフォーム（テーブル名、レコードID、変更種別、日付範囲）
- [ ] 変更履歴テーブル
- [ ] 詳細差分表示（before / after JSON 表示）
- [ ] CSV 出力

`SeedSnapshotsPage`

- [ ] スナップショット一覧テーブル
- [ ] 新規作成ダイアログ（名前・説明）
- [ ] 復元実行（警告ダイアログ付き）
- [ ] 削除

---

## 5. 既知のギャップ & 今後の調査タスク

現時点でも API カバレッジは約 22% に留まっており、以下のようなギャップが想定される。

※具体的な API 名は OpenAPI / `api_reference` を再確認しつつ、順次追記する。

### 5.1 既知・想定されるギャップ（例）

- 一部の管理系 API（バッチジョブ、診断、統計など）に対応する UI がまだない
- ユーザーや認可設定まわりの UI が不足している可能性
- 旧 API と新 API が混在している期間の「移行用画面」が必要になるかもしれない

### 5.2 今後の調査タスク

- [ ] OpenAPI から API 一覧を抽出し、機能カテゴリごとにグルーピングする
- [ ] 各カテゴリごとに「UI が存在するか / 不足しているか」を表にする
- [ ] 不足 UI をこのドキュメントの「フェーズ」に追加 or 新しいフェーズを定義する
- [ ] 使われなくなった旧 UI / 旧 API の整理方針を決める（deprecate → 削除）

---

## 6. このドキュメントの運用ルール

- 新しいページを追加したら、必ず **3. 新規スケルトンページ一覧** に追記する
- 既存ページに機能を追加したら、該当フェーズの TODO を更新し、
  状態が変わったらテーブルの「状態」を更新する
  - 例: `スケルトン` → `CRUD 実装済` → `本番運用中` など
- 大きなフェーズ（Phase 1〜4）が完了したら、そのフェーズのセクションに
  「完了日」と簡単な振り返りメモを追加する
- AI に作業を依頼する場合は、**このファイルのパスを必ずプロンプトに含める**
  （「ここに書いてある方針に従ってください」と明示する）

---

## 付録: 変更履歴

### 2025-11-16

- ドキュメント新規作成
- 14個のスケルトンページ追加に伴う初版作成
- Phase 0〜4 の実装方針を策定
